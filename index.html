<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Caccia al Tesoro Halloween 2025</title>
<style>
:root { --accent: #ff0000; --bg: rgba(0,0,0,0.75); }
html, body {
  height:100dvh;
  margin:0;
  padding:0;
  font-family:'Cinzel',serif;
  background: url('sfondo_horror2.jpg') center/cover fixed no-repeat;
  color:#fff;
  overflow:hidden;
}

/* --- Fiamme contorno --- */
.flame-container {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 10;
}
.flame {
  position: absolute;
  bottom: 0;
  width: 20px;
  height: 80px;
  background: linear-gradient(to top, rgba(255,140,0,0.8), rgba(255,69,0,0.5), transparent);
  border-radius: 50% 50% 50% 50%;
  animation: flicker 1s infinite alternate;
}
@keyframes flicker {
  0% { transform: scaleY(1) translateY(0); opacity: 0.6; }
  50% { transform: scaleY(1.3) translateY(-20px); opacity: 1; }
  100% { transform: scaleY(1) translateY(0); opacity: 0.6; }
}

/* --- Layout e stile gioco --- */
.page {
  position: relative;
  z-index: 1;
  min-height:100dvh;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:12px;
  padding:16px;
}
h1{
  margin:0;
  color:#ffcc00;
  text-shadow:0 0 12px #ff9900;
  font-size:1.6rem;
  text-align:center;
  transition:color .3s, text-shadow .3s;
}
.panel{
  width:100%;
  max-width:420px;
  background:var(--bg);
  border:2px solid var(--accent);
  border-radius:14px;
  padding:12px;
  text-align:center;
  box-shadow: 0 6px 18px rgba(0,0,0,0.6);
  transition:border-color .3s, background .3s;
}
.label { margin:6px 0 10px; font-weight:700; letter-spacing:1px; }
.letters {
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:8px;
  min-height:72px;
  align-items:center;
  padding:8px;
}
.letter{
  width:44px;
  height:44px;
  border-radius:8px;
  border:2px solid var(--accent);
  background:#111;
  color:#ff3333;
  font-weight:800;
  font-size:20px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  user-select:none;
  transition:all .3s;
}
.letter.correct {
  color: #00ff66;
  border-color: #00ff66;
  background: rgba(0,50,0,0.8);
  animation: pulseGreen 0.6s infinite;
}
@keyframes pulseGreen {
  0% { transform: scale(1); box-shadow: 0 0 4px #00ff66; }
  50% { transform: scale(1.1); box-shadow: 0 0 12px #00ff66; }
  100% { transform: scale(1); box-shadow: 0 0 4px #00ff66; }
}
.message{
  width:100%;
  box-sizing:border-box;
  padding:8px 6px;
  font-size:0.95rem;
  color:#fff;
  text-shadow:0 0 6px #000;
}
#readButton, #retryButton{
  display:inline-block;
  margin-top:8px;
  padding:10px 18px;
  border-radius:8px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-weight:700;
  font-size:1rem;
  cursor:pointer;
}
#readButton:active, #retryButton:active{ transform:scale(0.98); }
.modal-overlay{
  display:none;
  position:fixed;
  inset:0;
  background: rgba(0,0,0,0.6);
  align-items:center;
  justify-content:center;
  z-index:9999;
}
.modal {
  background: rgba(0,0,0,0.9);
  border:2px solid var(--accent);
  padding:14px;
  max-width:420px;
  width:90%;
  color:#ffcccc;
  border-radius:10px;
  text-align:center;
  box-shadow:0 8px 30px rgba(0,0,0,0.6);
  font-style:italic;
}
.modal button { margin-top:10px; padding:8px 12px; border-radius:8px; border:none; background:var(--accent); color:#fff; cursor:pointer; }
.flash{ position:fixed; inset:0; background:#fff; opacity:.85; z-index:10000; animation:fadeFlash .28s forwards; pointer-events:none; }
@keyframes fadeFlash{ from {opacity:.85} to {opacity:0} }

@keyframes shake {
  0% { transform: translate(0px, 0px); }
  20% { transform: translate(-2px, 0px); }
  40% { transform: translate(2px, 0px); }
  60% { transform: translate(-2px, 0px); }
  80% { transform: translate(2px, 0px); }
  100% { transform: translate(0px, 0px); }
}
.panel.shake { animation: shake 0.3s; }

@media (max-height:600px){
  .letters { min-height:56px; gap:6px; }
  .letter { width:38px; height:38px; font-size:18px; }
}
</style>
</head>
<body>
<div class="flame-container" id="flameContainer"></div>

<div class="page">
  <h1 id="title">Caccia al Tesoro Halloween 2025</h1>
  <div class="panel" id="panelWord" aria-label="Componi la parola">
    <div class="label">COMPONI LA PAROLA con 7 lettere:</div>
    <div id="wordArea" class="letters" aria-live="polite"></div>
  </div>
  <div class="panel" id="panelLetters" aria-label="Lettere disponibili">
    <div class="label">LETTERE DISPONIBILI:</div>
    <div id="lettersArea" class="letters" aria-live="polite"></div>
  </div>
</div>

<div id="modalOverlay" class="modal-overlay" role="dialog" aria-hidden="true">
  <div class="modal" role="document">
    <div id="clueText">Complimenti, ru nome de ru demone avete trovatu, ma tutt chesto pe ru ferm√† non √® bastatu. Sulu na cosa mo ve resta ra fa, accuminciate a legge sotta i po ngapu v'aveta ratt√†.....Pecch√® si stu demone volete nzerr√†, allora le cerevella aveta fa sosci√†. Issu e cocche cosa che non se trova ndo la natura, i sulu re na cosa se mbaura, ma a si ve lo potesse rice‚Ä¶.maronna mia m'avessena benerice. Allora facemmo cusi, non ve lo posso rice, ma ve lo posso fa capi. i quant e vero Cristo ca ngoppa a st'indizio, ve c'aggia fa muri‚Ä¶..Tutti lo tenemmo, ma pochi lo regalano, sacro issu √®, ma maronne non √®!!! Non se magna i non se beve, non √® mancu tantu finu, √® nu poco comme a lo vinu!! Ru posto non √® grosso, l'acqua ce sta ma non √® nu fosso. Ce passi spissu pe la, ma non te ve mai la voglia re te ce ferm√†. Tre persone importanti ce so passate i na vota all'annu ne parlate."</div>
    <button id="closeClue">CHIUDI</button>
  </div>
</div>

<script>
const correctWord = "ASMODEO";
const letters = ["A","S","M","O","D","E","O","V","A","L","A","K"];

const wordArea = document.getElementById('wordArea');
const lettersArea = document.getElementById('lettersArea');
const modalOverlay = document.getElementById('modalOverlay');
const closeClueBtn = document.getElementById('closeClue');
const panelWord = document.getElementById('panelWord');
const panelLetters = document.getElementById('panelLetters');
const flameContainer = document.getElementById('flameContainer');

let readButtonEl = null;
let messageEl = null;
let successActive = false;
let audioStarted = false;

/* ---------- CREAZIONE FIAMME ---------- */
for(let i=0;i<40;i++){
  const flame = document.createElement('div');
  flame.className = 'flame';
  flame.style.left = Math.random()*100 + '%';
  flame.style.height = 50 + Math.random()*80 + 'px';
  flame.style.animationDuration = 0.6 + Math.random()*0.8 + 's';
  flameContainer.appendChild(flame);
}

/* ---------- AUDIO ---------- */
const audio1 = new Audio('traccia1.mp3'); audio1.loop = true; audio1.volume = 0.5;
const audio2 = new Audio('traccia2.mp3'); audio2.volume = 0.7;
const audio3 = new Audio('traccia3.mp3'); audio3.loop = false; audio3.volume = 0.6;
const audio4 = new Audio('traccia4.mp3'); audio4.loop = true; audio4.volume = 0.4;

/* ---------- LETTERE ---------- */
function shuffle(arr){ return arr.slice().sort(()=>Math.random()-0.5); }
function triggerFlash(){ const f=document.createElement('div'); f.className='flash'; document.body.appendChild(f); setTimeout(()=>f.remove(),280); }

function createLetterElements(){
  lettersArea.innerHTML = '';
  const shuffled = shuffle(letters);
  shuffled.forEach((ch, idx) => {
    const el = document.createElement('div');
    el.className = 'letter';
    el.textContent = ch;
    el.draggable = true;
    el.id = 'letter-' + idx + '-' + Date.now();
    el.addEventListener('dragstart', e => e.dataTransfer.setData('text/plain', el.id));
    el.addEventListener('click', () => {
      if(!audioStarted){ audio1.play().catch(()=>{}); audioStarted=true; }
      moveLetterByClick(el);
    });
    lettersArea.appendChild(el);
  });
}

function moveLetterByClick(letterEl){
  if(successActive) return;
  const wasInLetters = letterEl.parentElement === lettersArea;
  removeMessageIfAny();
  if (wasInLetters) wordArea.appendChild(letterEl);
  else lettersArea.appendChild(letterEl);
  checkWord();
}

function allowDrop(ev){ ev.preventDefault(); }
function handleDrop(ev){
  if(successActive) return;
  ev.preventDefault();
  const id = ev.dataTransfer.getData('text/plain');
  const el = document.getElementById(id);
  if (!el) return;
  removeMessageIfAny();
  ev.currentTarget.appendChild(el);
  checkWord();
}

function removeMessageIfAny(){
  if (messageEl && messageEl.parentElement) { messageEl.remove(); messageEl = null; }
  if (readButtonEl && readButtonEl.parentElement) { readButtonEl.remove(); readButtonEl = null; }
}

wordArea.addEventListener('dragover', allowDrop);
lettersArea.addEventListener('dragover', allowDrop);
wordArea.addEventListener('drop', handleDrop);
lettersArea.addEventListener('drop', handleDrop);

/* ---------- VERIFICA ---------- */
function checkWord(){
  const lettersInWord = Array.from(wordArea.querySelectorAll('.letter'));
  const formed = lettersInWord.map(l => l.textContent).join('');
  const neededCount = correctWord.length;

  lettersInWord.forEach(l => l.classList.remove('correct'));
  if(lettersInWord.length < neededCount) return;

  lettersInWord.forEach((l, idx) => {
    if(correctWord[idx] === l.textContent) l.classList.add('correct');
  });

  if(formed === correctWord){
    successActive = true;
    showMessageInLettersArea("üëπ COMPLIMENTI, HAI INDOVINATO IL NOME DEL DEMONE!", true);
    triggerFlash();
    playSuccessSound();
  } else {
    showMessageInLettersArea("‚ùå PAROLA ERRATA, RIPROVA.", false);
    playErrorSound();
    panelWord.classList.add('shake');
    panelLetters.classList.add('shake');
    setTimeout(()=>{panelWord.classList.remove('shake'); panelLetters.classList.remove('shake');}, 300);
  }
}

function showMessageInLettersArea(text, success){
  removeMessageIfAny();
  lettersArea.innerHTML = '';
  messageEl = document.createElement('div');
  messageEl.className = 'message';
  messageEl.textContent = text;
  lettersArea.appendChild(messageEl);

  if(success){
    readButtonEl = document.createElement('button');
    readButtonEl.id = 'readButton';
    readButtonEl.textContent = 'LEGGI';
    readButtonEl.addEventListener('click', () => {
      modalOverlay.style.display = 'flex';
      modalOverlay.setAttribute('aria-hidden', 'false');
      // non fermare audio3/4
    });
    lettersArea.appendChild(readButtonEl);
  } else {
    const retryBtn = document.createElement('button');
    retryBtn.id = 'retryButton';
    retryBtn.textContent = 'RIPROVA';
    retryBtn.addEventListener('click', resetGame);
    lettersArea.appendChild(retryBtn);
  }
}

function resetGame(){
  wordArea.innerHTML = '';
  createLetterElements();
  removeMessageIfAny();
}

function playErrorSound(){
  audio2.currentTime = 0;
  audio2.play().catch(()=>{});
}

function playSuccessSound(){
  audio1.pause();
  audio2.pause();
  if(audio3.paused){ audio3.currentTime = 0; audio3.play().catch(()=>{}); }
  if(audio4.paused){ audio4.currentTime = 0; audio4.play().catch(()=>{}); }
}

closeClueBtn.addEventListener('click', () => {
  modalOverlay.style.display = 'none';
  modalOverlay.setAttribute('aria-hidden', 'true');
  successActive = false;
  resetGame();
});

modalOverlay.addEventListener('click', (e) => { if (e.target === modalOverlay) closeClueModal(); });
function closeClueModal(){
  modalOverlay.style.display = 'none';
  modalOverlay.setAttribute('aria-hidden', 'true');
  successActive = false;
  resetGame();
}

createLetterElements();
</script>
</body>
</html>





