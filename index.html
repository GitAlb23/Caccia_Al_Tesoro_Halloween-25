<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Caccia al Tesoro Halloween 2025</title>
<style>
  html,body{
    margin:0;
    padding:0;
    width:100%;
    height:100dvh; /* viewport dinamica compatibile mobile */
    overflow:hidden;
    font-family:'Cinzel',serif;
    background:url('sfondo_horror2.jpg') no-repeat center center fixed;
    background-size:cover;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    color:white;
  }

  h1{
    color:#ffcc00;
    text-shadow:0 0 15px #ff9900;
    margin-bottom:10px;
    text-align:center;
  }

  .container{
    background:rgba(0,0,0,0.7);
    border:2px solid #ff0000;
    border-radius:15px;
    padding:10px;
    text-align:center;
    width:90%;
    max-width:400px;
    margin:6px 0;
  }

  .letters{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:6px;
    min-height:60px;
  }

  .letter{
    width:42px;
    height:42px;
    background:#111;
    border:2px solid #ff0000;
    border-radius:8px;
    color:#ff3333;
    font-size:20px;
    font-weight:bold;
    display:flex;
    align-items:center;
    justify-content:center;
    cursor:pointer;
    user-select:none;
  }

  .letter:active{
    transform:scale(1.05);
  }

  .message{
    font-size:0.95rem;
    margin:8px 0;
    color:white;
    text-shadow:0 0 6px black;
  }

  #readButton{
    display:inline-block;
    margin-top:6px;
    background-color:#ff0000;
    color:white;
    border:none;
    border-radius:8px;
    padding:6px 12px;
    font-size:15px;
    cursor:pointer;
    transition:transform 0.2s,box-shadow 0.2s;
  }

  #readButton:hover{
    transform:scale(1.05);
    box-shadow:0 0 10px #ff0000;
  }

  #clue{
    display:none;
    margin-top:10px;
    padding:10px;
    border:2px solid #ff0000;
    border-radius:10px;
    background:rgba(0,0,0,0.8);
    color:#ffcccc;
    font-style:italic;
    max-width:400px;
    text-align:center;
  }

  .flash{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,0.8);
    opacity:0;
    pointer-events:none;
    z-index:999;
    animation:flashAnimation 0.3s forwards;
  }

  @keyframes flashAnimation{
    0%{opacity:0.8;}
    100%{opacity:0;}
  }
</style>
</head>
<body>

<h1>Caccia al Tesoro Halloween 2025</h1>

<div class="container">
  <p>COMPONI LA PAROLA:</p>
  <div id="wordArea" class="letters"></div>
</div>

<div class="container">
  <p>LETTERE DISPONIBILI:</p>
  <div id="lettersArea" class="letters"></div>
</div>

<div id="clue">L‚Äôindizio del tesoro hai trovo, i ru cazzu me cagatu. Se ru demone vu nzerr√†, chella cosa rossa a trov√†!!</div>

<script>
const correctWord = "ASMODEO";
const letters = ["A","S","M","O","D","E","O"];

const wordArea = document.getElementById("wordArea");
const lettersArea = document.getElementById("lettersArea");
const clue = document.getElementById("clue");

function shuffle(array){ return array.slice().sort(()=>Math.random()-0.5); }

function triggerFlash(){
  const flash=document.createElement("div");
  flash.classList.add("flash");
  document.body.appendChild(flash);
  setTimeout(()=>flash.remove(),300);
}

function createLetterElements(){
  lettersArea.innerHTML="";
  const shuffled=shuffle(letters);
  shuffled.forEach((letter,i)=>{
    const el=document.createElement("div");
    el.className="letter";
    el.textContent=letter;
    el.draggable=true;
    el.id="letter"+i;
    el.addEventListener("dragstart",drag);
    el.addEventListener("click",()=>moveLetter(el));
    lettersArea.appendChild(el);
  });
}

function allowDrop(ev){ev.preventDefault();}
function drag(ev){ev.dataTransfer.setData("text",ev.target.id);}
function drop(ev){
  ev.preventDefault();
  const id=ev.dataTransfer.getData("text");
  const letter=document.getElementById(id);
  if(!letter)return;
  if(ev.currentTarget.classList.contains("letters")){
    ev.currentTarget.appendChild(letter);
    checkWord();
  }
}

function moveLetter(el){
  if(el.parentElement===lettersArea){
    wordArea.appendChild(el);
  }else{
    lettersArea.appendChild(el);
  }
  checkWord();
}

wordArea.addEventListener("dragover",allowDrop);
lettersArea.addEventListener("dragover",allowDrop);
wordArea.addEventListener("drop",drop);
lettersArea.addEventListener("drop",drop);

function clearMessages(){
  const msg=document.querySelector(".message");
  if(msg) msg.remove();
  const btn=document.getElementById("readButton");
  if(btn) btn.remove();
}

function checkWord(){
  const formed=[...wordArea.children].map(l=>l.textContent).join("");
  const allPlaced=wordArea.children.length===letters.length;

  // se l'utente ha iniziato a spostare le lettere di nuovo, cancella messaggi
  if(wordArea.children.length<letters.length){
    const msg=document.querySelector(".message");
    if(msg) clearMessages();
    clue.style.display="none";
  }

  if(!allPlaced)return; // controlla solo quando tutte le lettere sono piazzate

  clearMessages();

  const msg=document.createElement("div");
  msg.className="message";

  if(formed===correctWord){
    msg.textContent="üëπ COMPLIMENTI, HAI INDOVINATO IL NOME DEL DEMONE E HAI SBLOCCATO L‚ÄôULTIMO INDIZIO CHE TI PORTER√Ä AL TESORO.";
    lettersArea.innerHTML="";
    lettersArea.appendChild(msg);

    const btn=document.createElement("button");
    btn.id="readButton";
    btn.textContent="LEGGI";
    btn.addEventListener("click",showClue);
    lettersArea.appendChild(btn);

    triggerFlash();
  }else{
    msg.textContent="‚ùå PAROLA ERRATA, RIPROVA.";
    lettersArea.innerHTML="";
    lettersArea.appendChild(msg);
  }
}

function showClue(){
  clue.style.display="block";
  clue.scrollIntoView({behavior:"smooth"});
}

createLetterElements();
</script>

</body>
</html>
